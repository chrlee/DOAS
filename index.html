<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
        <title>Christian | Lee</title>
        <link href="https://fonts.googleapis.com/css?family=Lato:100&display=swap" rel="stylesheet">		
        <style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
            .text {
                position: absolute;
                width: 100%;
                display: block;
                z-index: 100;
            }
            #header {
                font-family: 'Lato', sans-serif;
                font-size: 3em;
                color: #636e72;
                padding-top: 5vh;
                padding-bottom: 5vh;
                padding-left: 3vw;
            }
            #footer {
                font-family: 'Lato', sans-serif;
                font-size: 1em;
                text-align: center;
                color: #636e72;
                bottom: 0;
                padding-bottom: 1vh;
            }
		</style>
	</head>
	<body>
    <div id="header" class="text">C h r i s t i a n   |   L e e</div>
    <footer><div id="footer" class="text">This website is a <b>work in progress</b> and is
    <b>being actively improved and updated</b></div></footer>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/105/three.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.8.12/Tone.js"></script>
    <script src="js/teoria.js"></script>
    <script src="js/geometries/ConvexGeometry.js"></script>
    <script src="js/math/ConvexHull.js"></script>
    <script src="js/controls/OrbitControls.js"></script>
    <script>
    
	// thanks to https://gist.github.com/stephanbogner/a5f50548a06bec723dcb0991dcbb0856
    var numberOfPoints = 10;
    var extraPoints = 0;
    var radiusOfSphere = 10;
    var group = new THREE.Group();
    var fibonacciSpherePoints = getFibonacciSpherePoints(numberOfPoints, radiusOfSphere);

    var scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0xffffff, 70, 135);
    scene.background = new THREE.Color(0xffffff);
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 500);
    camera.position.set(0, 0, 60);
    camera.lookAt(new THREE.Vector3(0, 0, 0));
    var renderer = new THREE.WebGLRenderer({alpha: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    

    // controls

    var controls = new THREE.OrbitControls( camera, renderer.domElement );
	controls.minDistance = 50;
    controls.maxDistance = 120;
    
    // interactivity

    var raycaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();
    var colors = new Float32Array( numberOfPoints * 3 );
    var sizes = new Float32Array( numberOfPoints );
    var particles;
    
    window.addEventListener( 'resize', onWindowResize, false );
	document.addEventListener( 'mousemove', onDocumentMouseMove, false );
    document.addEventListener( 'mousedown', onDocumentMouseDown, false );

    initSceneAndAddFibonacciSphere(fibonacciSpherePoints);
    function getFibonacciSpherePoints(samples, radius, randomize) {
        samples = samples || 1;
        radius = radius || 1;
        randomize = randomize || false;
        var random = 1;
        if (randomize === true) {
            random = Math.random() * samples;
        }
        var points = []
        var offset = 2 / samples
        var increment = Math.PI * (3 - Math.sqrt(5));
        for (var i = 0; i < samples; i++) {
            var y = ((i * offset) - 1) + (offset / 2);
            var distance = Math.sqrt(1 - Math.pow(y, 2));
            var phi = ((i + random) % samples) * increment;
            var x = Math.cos(phi) * distance;
            var z = Math.sin(phi) * distance;
            x = x * radius;
            y = y * radius;
            z = z * radius;
            points.push(new THREE.Vector3(x, y, z));
        }
        return points;
    }

    var mesh;
    
    function initSceneAndAddFibonacciSphere(fibonacciSpherePoints) {
		var lineMaterial = new THREE.LineDashedMaterial( {
            color: 0xb2bec3,
            linewidth: 1,
            scale: 1,
            dashSize: 0.8,
            gapSize: 1,
        } );
        for (var i = 0; i < fibonacciSpherePoints.length; i++) {
            var point = fibonacciSpherePoints[i];
            var radius = 0.5;
            var geometry = new THREE.SphereGeometry(radius);
            var material = new THREE.MeshBasicMaterial({ color: 0xeb4d4b,
                                                         polygonOffset: true,
                                                         polygonOffsetFactor: 1,
                                                         polygonOffsetUnits: 1 });
            var sphere = new THREE.Mesh(geometry, material);
            sphere.position.x = point.x;
            sphere.position.y = point.y;
            sphere.position.z = point.z;
            sphere.name = i;
            group.add(sphere);
        }
        var lineGeometry = new THREE.ConvexGeometry(fibonacciSpherePoints);
        var edgeGeometry = new THREE.EdgesGeometry(lineGeometry);
        mesh = new THREE.LineSegments( edgeGeometry, lineMaterial ).computeLineDistances();
        scene.add(mesh);
		scene.add(group);
    }
    
    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    function onDocumentMouseMove( event ) {

        event.preventDefault();

        mouse.x = ( event.offsetX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.offsetY / window.innerHeight ) * 2 + 1;

    }
    
    var intersected = group.children[0];
    
    function onDocumentMouseDown( event ) {
        
        event.preventDefault();
        
        var intersects = raycaster.intersectObjects( group.children );
        if ( intersects.length > 0 ) {
            
            if(intersected.name === intersects[ 0 ].object.name) {
                var color = Math.random() * 0xffffff;
                intersects[ 0 ].object.material.color.setHex( color );
                scene.background = new THREE.Color( color ).addScalar(0.5);
                intersected = intersects[ 0 ].object;
                var synth = new Tone.Synth().toMaster()
                
                //play a middle 'C' for the duration of an 8th note
                synth.triggerAttackRelease(teoria.note('C4')
                                                 .scale('ionian')
                                                 .get(intersected.name)
                                                 .toString(), '8n')
            }
            else{
                
            }
        }
    }
    

    function animate() {
        requestAnimationFrame( animate );

        group.rotation.x += 0.0005;
        group.rotation.y += 0.0005;
        group.rotation.z += 0.0005;

        mesh.rotation.x += 0.0005;
        mesh.rotation.y += 0.0005;
        mesh.rotation.z += 0.0005;
        
        scene.background.addScalar(0.02);

        raycaster.setFromCamera( mouse, camera );

        var intersects = raycaster.intersectObjects( group.children );

        if ( intersects.length > 0 ) {
            intersects[ 0 ].object.scale.set(1.3, 1.3, 1.3);
            intersected = intersects[ 0 ].object;
        } else {
            intersected.scale.set(1, 1, 1);
        }

        renderer.render( scene, camera );
    }

    animate();
    </script>
	</body>
</html>
